<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>University Finder Bot</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">
  <div class="w-full max-w-3xl bg-white shadow-lg rounded-lg p-6">
    <h1 class="text-2xl font-bold text-center text-blue-600 mb-4">ðŸŽ“ University Finder Chatbot</h1>

    <div id="chatBox" class="space-y-4 mb-6 px-2 max-h-96 overflow-y-auto">
      {% for msg in messages %}
        <div class="flex {{ 'justify-start' if msg.sender == 'user' else 'justify-end' }}">
          <div class="{{ 'bg-blue-100 text-blue-900' if msg.sender == 'user' else 'bg-green-100 text-green-900' }} px-4 py-2 rounded-lg max-w-lg whitespace-pre-line">
            {{ msg.text | safe }}
          </div>
        </div>
      {% endfor %}
    </div>

    <!-- Chat form -->
    <form id="chatForm" method="POST" class="flex space-x-2 items-start">
      <textarea id="user_input" name="user_input" placeholder="Type your message..."
                class="flex-grow px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 resize-none"
                rows="2" required></textarea>

      <button id="micButton" type="button" onclick="toggleDictation()"
              class="px-3 py-2 bg-gray-200 rounded hover:bg-gray-300 text-xl mt-1">ðŸŽ¤</button>

      <button type="submit"
              class="px-4 py-2 bg-blue-500 text-white font-semibold rounded-lg hover:bg-blue-600 transition mt-1">
        Send
      </button>
    </form>
  </div>

  <!-- JavaScript -->
  <script>
    let recognition;
    let isListening = false;

    function toggleDictation() {
      const micButton = document.getElementById("micButton");

      if (!isListening) {
        if ('webkitSpeechRecognition' in window) {
          recognition = new webkitSpeechRecognition();
          recognition.continuous = false;
          recognition.interimResults = false;
          recognition.lang = "en-US";

          recognition.onstart = function () {
            isListening = true;
            micButton.innerText = "âœ…";
          };

          recognition.onresult = function (event) {
            const transcript = event.results[0][0].transcript;
            document.getElementById("user_input").value = transcript;
          };

          recognition.onend = function () {
            stopDictation();
          };

          recognition.onerror = function (event) {
            console.error("Speech recognition error:", event.error);
            stopDictation();
          };

          recognition.start();
        } else {
          alert("Your browser does not support speech recognition.");
        }
      } else {
        stopDictation();
      }
    }

    function stopDictation() {
      const micButton = document.getElementById("micButton");
      if (recognition) recognition.stop();
      isListening = false;
      micButton.innerText = "ðŸŽ¤";
    }

    // Auto-scroll to bottom on page load
    window.onload = function () {
      const chatBox = document.getElementById("chatBox");
      if (chatBox) {
        chatBox.scrollTop = chatBox.scrollHeight;
      }
    };

    // Enable Shift+Enter for newline, Enter to submit
    const textarea = document.getElementById("user_input");
    textarea.addEventListener("keydown", function (e) {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        document.getElementById("chatForm").submit();
      }
    });
  </script>
</body>
</html>
